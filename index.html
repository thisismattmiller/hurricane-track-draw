<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title></title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background-color: whitesmoke;
      font-family: sans-serif;
    }
  </style>
</head>
<body>
<div style="margin: auto; width: 1000px; text-align: center;">
  <h3>Generative Tropical Cyclones Drawings</h3>
  <span>Below is a drawing generated by the paths of tropical cyclones. Their start locations are randomize but the line follows the path of the storm. Refresh for a new drawing. The <a href="https://data.noaa.gov/dataset/ncdc-international-best-track-archive-for-climate-stewardship-ibtracs-project-version-3">data</a> came from NCDC International Best Track Archive for Climate Stewardship (IBTrACS) Project.</span><br>
  <br/>
  <strong>Please consider donating to support the recovery from <a href="https://www.charitynavigator.org/index.cfm?bay=content.view&cpid=5239&from=homepage">Hurricane Harvey</a> and <a href="https://www.charitynavigator.org/index.cfm?bay=content.view&cpid=5243&from=homepage">Hurricane Irma</a></strong>
  <br/>
</div>
<hr/>
<div style="margin: auto; width: 1000px; text-align: center;">
  Drawing of <span id="totalH"></span> tropical cyclones from <span id="start"></span>-<span id="end"></span> <a style="font-size: 0.75em"  href="#" id="show-names">(Names)</a> -- <a download="image.png" href="#" id="dl">Download</a>
  <br>
  <div id="names" style="display: none;"></div>
</div>

<div style="margin: auto; width: 1000px; text-align: center;">
  <canvas id="container" width="1000" height="850"></canvas>  
</div>

  <script>

    var colors = ["#1b70fc", "#faff16", "#d50527", "#158940", "#f898fd", "#24c9d7", "#cb9b64", "#866888", "#22e67a", "#e509ae", "#9dabfa", "#437e8a", "#b21bff", "#ff7b91", "#94aa05", "#ac5906", "#82a68d", "#fe6616", "#7a7352", "#f9bc0f", "#b65d66", "#07a2e6", "#c091ae", "#8a91a7", "#88fc07", "#ea42fe", "#9e8010", "#10b437", "#c281fe", "#f92b75", "#07c99d", "#a946aa", "#bfd544", "#16977e", "#ff6ac8", "#a88178", "#5776a9", "#678007", "#fa9316", "#85c070", "#6aa2a9", "#989e5d", "#fe9169", "#cd714a", "#6ed014", "#c5639c", "#c23271", "#698ffc", "#678275", "#c5a121", "#a978ba", "#ee534e", "#d24506", "#59c3fa", "#ca7b0a", "#6f7385", "#9a634a", "#48aa6f", "#ad9ad0", "#d7908c", "#6a8a53", "#8c46fc", "#8f5ab8", "#fd1105", "#7ea7cf", "#d77cd1", "#a9804b", "#0688b4", "#6a9f3e", "#ee8fba", "#a67389", "#9e8cfe", "#bd443c", "#6d63ff", "#d110d5", "#798cc3", "#df5f83", "#b1b853", "#bb59d8", "#1d960c", "#867ba8", "#18acc9", "#25b3a7", "#f3db1d", "#938c6d", "#936a24", "#a964fb", "#92e460", "#a05787", "#9c87a0", "#20c773", "#8b696d", "#78762d", "#e154c6", "#40835f", "#d73656", "#1afd5c", "#c4f546", "#3d88d8", "#bd3896", "#1397a3", "#f940a5", "#66aeff", "#d097e7", "#fe6ef9", "#d86507", "#8b900a", "#d47270", "#e8ac48", "#cf7c97", "#cebb11", "#718a90", "#e78139", "#ff7463", "#bea1fd"];
    var years = [1840,1850,1860,1870,1880,1890,1900,1910,1920,1930,1940,1950,1960,1970,1980,1990,2000,2010];
    var groupings = [500,1000,2000,3000,4000,5000,6000,7000,8000,9000,10000];
    var decadesUsed = [];
    var names = [];
    var pallet = {};
    var canvas = null;

    for (var y = 0; y < years.length; y++) {
      pallet[years[y]] = colors[Math.floor(Math.random() * colors.length)]
    }
    console.log(pallet)
    var request = new XMLHttpRequest();
    request.open('GET', 'pixles.json', true);

    request.onload = function() {
      if (request.status >= 200 && request.status < 400) {
        // Success!
        var data = JSON.parse(request.responseText);
      } else {
        // We reached our target server, but it returned an error
         alert('Error dowloading json');
      }
      

      canvas = document.getElementById('container');
      var context = canvas.getContext('2d');


      context.fillStyle = "white";
      context.fillRect(0, 0, canvas.width, canvas.height);

      var use = groupings[Math.floor(Math.random() * groupings.length)];

      var subset = []

      for (var d = 0; d < use; d++) {
        subset.push(data[Math.floor(Math.random() * data.length)])
      }


      for (var d = 0; d < subset.length; d++) {
        var p = [];
        var offsetX = Math.floor(Math.random() * Math.floor(Math.random() * 500));
        var offsetY = Math.floor(Math.random() * Math.floor(Math.random() * 300))

        context.beginPath();
        context.moveTo(subset[d].pixles[0][0] - offsetX, subset[d].pixles[0][1] - offsetY);

        var lastX = subset[d].pixles[0][0] - offsetX;
        var lastY = subset[d].pixles[0][1] - offsetY;

        for (var i = 1; i < subset[d].pixles.length; i++) {

          var nextX = subset[d].pixles[i][0] - offsetX;
          var nextY = subset[d].pixles[i][1] - offsetY;

          if (Math.abs(Math.abs(lastX) - Math.abs(nextX)) > 100){
            break;
          }
          if (Math.abs(Math.abs(lastY) - Math.abs(nextY)) > 100){
            break;
          }

          lastX = nextX
          lastY = nextY
          context.lineTo(nextX, nextY);
          // p.push(subset[d].pixles[i][0] - offset);
          // p.push(subset[d].pixles[i][1] - offset);
          
        }
        context.lineWidth = Math.floor(Math.random() * 5);
        context.strokeStyle = pallet[subset[d].decade];
        context.stroke();
        
        if (decadesUsed.indexOf(subset[d].decade) === -1){
          decadesUsed.push(subset[d].decade);
        }
        if (names.indexOf(subset[d].name) === -1){
          names.push(subset[d].name);
        }

        
      }


      decadesUsed = decadesUsed.sort();

      document.querySelector("#totalH").innerHTML = use;
      document.querySelector("#start").innerHTML = decadesUsed[0];
      document.querySelector("#end").innerHTML = decadesUsed[decadesUsed.length-1];
      document.querySelector("#names").innerHTML = names.join(', ');

      document.getElementById("show-names").addEventListener('click', function(){  document.querySelector("#names").style.display = 'block' }, false);


    };

    request.onerror = function() {
      // There was a connection error of some sort
      alert('Error dowloading json');
    };
    request.send();

    function dlCanvas() {
      var dt = canvas.toDataURL('image/png');
      /* Change MIME type to trick the browser to downlaod the file instead of displaying it */
      dt = dt.replace(/^data:image\/[^;]*/, 'data:application/octet-stream');

      /* In addition to <a>'s "download" attribute, you can define HTTP-style headers */
      dt = dt.replace(/^data:application\/octet-stream/, 'data:application/octet-stream;headers=Content-Disposition%3A%20attachment%3B%20filename=Canvas.png');

      this.href = dt;
    };
    document.getElementById("dl").addEventListener('click', dlCanvas, false);




  </script>
</body>
</html>